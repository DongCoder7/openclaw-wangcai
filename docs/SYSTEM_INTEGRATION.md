# OpenClawæŠ•èµ„ç­–ç•¥ç³»ç»Ÿ - å®Œæ•´æµç¨‹æ•´åˆæ–‡æ¡£
## ç‰ˆæœ¬: v1.0 | æ›´æ–°æ—¥æœŸ: 2026-02-25

---

## ä¸€ã€ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
ç”¨æˆ·è¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸»æ§å…¥å£ (DounaiSystem)                   â”‚
â”‚  skills/dounai-investment-system/__init__.py                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŠŸèƒ½è·¯ç”±åˆ†å‘                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº§ä¸šé“¾åˆ†æ      â”‚  å¸‚åœºæŠ¥å‘Š       â”‚  ä¸ªè‚¡åˆ†æ               â”‚
â”‚  analyze_       â”‚  generate_      â”‚  analyze_stock()        â”‚
â”‚  industry()     â”‚  us_report()    â”‚                         â”‚
â”‚                 â”‚  generate_      â”‚                         â”‚
â”‚                 â”‚  ah_preopen()   â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŸ¥è¯†æ˜ŸçƒAPI   â”‚  â”‚ é•¿æ¡¥API       â”‚  â”‚ æ•°æ®åº“ + é•¿æ¡¥API      â”‚
â”‚ zsxq_fetcher â”‚  â”‚ longbridge   â”‚  â”‚ v26å› å­ + å®æ—¶è¡Œæƒ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¾“å‡ºæ•´åˆ                                  â”‚
â”‚  - çŸ¥è¯†æ˜Ÿçƒè°ƒç ”ä¿¡æ¯                                          â”‚
â”‚  - å®æ—¶è¡Œæƒ…æ•°æ®                                              â”‚
â”‚  - v26å› å­è¯„åˆ†                                               â”‚
â”‚  - äº§ä¸šé“¾åˆ†æ                                                â”‚
â”‚  - æŠ•èµ„å»ºè®®                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è‡ªåŠ¨æ¨é€                                  â”‚
â”‚  - é£ä¹¦æ¶ˆæ¯ (ä¸»è¦)                                           â”‚
â”‚  - æœ¬åœ°æ–‡ä»¶ä¿å­˜                                              â”‚
â”‚  - æ—¥å¿—è®°å½•                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ ¸å¿ƒSkillsæ¸…å•

| Skillåç§° | è·¯å¾„ | åŠŸèƒ½ | è§¦å‘æ–¹å¼ |
|:----------|:-----|:-----|:---------|
| **dounai-investment-system** | `skills/dounai-investment-system/` | ä¸»æ§å…¥å£ï¼Œç»Ÿä¸€è°ƒåº¦ | Pythonè°ƒç”¨ |
| **industry-chain-analysis** | `skills/industry-chain-analysis/` | äº§ä¸šé“¾æ·±åº¦åˆ†æ | ä¸»æ§è°ƒç”¨ |
| **us-market-analysis** | `skills/us-market-analysis/` | ç¾è‚¡éš”å¤œæŠ¥å‘Š | å®šæ—¶ä»»åŠ¡/ä¸»æ§è°ƒç”¨ |
| **ah-market-preopen** | `skills/ah-market-preopen/` | A+Hå¼€ç›˜å‰ç» | å®šæ—¶ä»»åŠ¡/ä¸»æ§è°ƒç”¨ |
| **a-stock-analysis** | `skills/a-stock-analysis/` | ä¸ªè‚¡v26å› å­åˆ†æ | ä¸»æ§è°ƒç”¨ |
| **investment-analysis-suite** | `skills/investment-analysis-suite/` | ç»Ÿä¸€è°ƒåº¦å°è£… | Pythonè°ƒç”¨ |

---

## ä¸‰ã€æ•°æ®æµAPIé…ç½®

### 3.1 é•¿æ¡¥API (å®æ—¶è¡Œæƒ…)

**é…ç½®æ–‡ä»¶**: `.longbridge.env`
```bash
LONGPORT_APP_KEY="68f2e2a62a7911943bd05db4bd584b6c"
LONGPORT_APP_SECRET="ede99d5e90a810122983f159f2bc947aa962a0844f13f6e540b90981937a26dd"
LONGPORT_ACCESS_TOKEN="m_eyJhbGciOiJSUzI1NiIs..."
```

**å°è£…æ¨¡å—**: `tools/longbridge_api.py`
- `get_quotes(symbols)` - æ‰¹é‡è·å–è¡Œæƒ…
- `get_quote(symbol)` - å•åªè‚¡ç¥¨è¡Œæƒ…
- æ”¯æŒAè‚¡/æ¸¯è‚¡/ç¾è‚¡

### 3.2 çŸ¥è¯†æ˜ŸçƒAPI (è°ƒç ”ä¿¡æ¯)

**é…ç½®æ–‡ä»¶**: `tools/zsxq_fetcher.py`
```python
COOKIES = "sensorsdata2015jssdkcross=...; zsxq_access_token=..."
```

**å°è£…å‡½æ•°**:
- `search_industry_info(keyword)` - æœç´¢è¡Œä¸šä¿¡æ¯
- `get_latest(count)` - è·å–æœ€æ–°æ–‡ç« 
- **æ³¨æ„**: é¢‘ç‡é™åˆ¶ï¼Œæ¯æ¬¡é—´éš”â‰¥30ç§’

### 3.3 æ•°æ®åº“ (å†å²å› å­)

**è·¯å¾„**: `data/historical/historical.db`

**æ•°æ®è¡¨**:
- `stock_factors` - æŠ€æœ¯æŒ‡æ ‡å› å­
- `stock_defensive_factors` - é˜²å¾¡å› å­
- `stock_fina` - è´¢åŠ¡æ•°æ®

---

## å››ã€å®šæ—¶ä»»åŠ¡é…ç½®

### 4.1 Crontabé…ç½®

```bash
# ç¼–è¾‘ crontab
crontab -e

# === ç¾è‚¡éš”å¤œæŠ¥å‘Š (08:30) ===
30 8 * * * cd ~/.openclaw/workspace && source setup_env.sh && python3 skills/us-market-analysis/scripts/generate_report_longbridge.py >> logs/us_market.log 2>&1

# === A+Hå¼€ç›˜å‰ç» (09:15) ===
15 9 * * * cd ~/.openclaw/workspace && source setup_env.sh && python3 skills/ah-market-preopen/scripts/generate_report_longbridge.py >> logs/ah_market.log 2>&1

# === æ”¶ç›˜æ·±åº¦æŠ¥å‘Š (15:00) ===
0 15 * * * cd ~/.openclaw/workspace && python3 tools/daily_market_report.py >> logs/daily_report.log 2>&1

# === çŸ¥è¯†æ˜Ÿçƒä¿¡æ¯ (æ¯2å°æ—¶) ===
0 */2 * * * cd ~/.openclaw/workspace && python3 tools/heartbeat_zsxq_fetch.py >> logs/zsxq.log 2>&1

# === ç­–ç•¥ä¼˜åŒ–å™¨ (æ¯15åˆ†é’Ÿ) ===
*/15 * * * * cd ~/.openclaw/workspace && python3 tools/auto_optimizer.py >> logs/optimizer.log 2>&1
```

### 4.2 Heartbeatä»»åŠ¡

**è§¦å‘æ–‡ä»¶**: `HEARTBEAT.md`

**æ‰§è¡Œå†…å®¹**:
1. æ•´ç‚¹çŠ¶æ€æ±‡æŠ¥
2. æ¨¡æ‹Ÿç›˜è·Ÿè¸ª
3. GitåŒæ­¥

---

## äº”ã€ä½¿ç”¨æµç¨‹

### 5.1 äº§ä¸šé“¾åˆ†ææµç¨‹

```python
# æ–¹å¼1: ä¸»æ§ç³»ç»Ÿè°ƒç”¨
from skills.dounai_investment_system import DounaiSystem

system = DounaiSystem()
result = system.analyze_industry("å­˜å‚¨èŠ¯ç‰‡")

# è‡ªåŠ¨æ‰§è¡Œ:
# 1. æœç´¢çŸ¥è¯†æ˜Ÿçƒ"å­˜å‚¨èŠ¯ç‰‡"ä¿¡æ¯
# 2. è·å–å­˜å‚¨èŠ¯ç‰‡äº§ä¸šé“¾è‚¡ç¥¨å®æ—¶è¡Œæƒ…
# 3. è®¡ç®—v26å› å­è¯„åˆ†
# 4. ç”ŸæˆæŠ•èµ„ç»„åˆå»ºè®®
# 5. è¾“å‡ºå®Œæ•´æŠ¥å‘Š
```

### 5.2 ä¸ªè‚¡åˆ†ææµç¨‹

```python
# å®Œæ•´åˆ†æå•åªè‚¡ç¥¨
from skills.dounai_investment_system import DounaiSystem

system = DounaiSystem()
analysis = system.analyze_stock(
    code="301421.SZ",
    include_zsxq=True,      # åŒ…å«çŸ¥è¯†æ˜Ÿçƒ
    include_industry=True,  # åŒ…å«äº§ä¸šé“¾
    include_factors=True    # åŒ…å«v26å› å­
)

# è¾“å‡º:
# - å®æ—¶è¡Œæƒ…
# - äº§ä¸šé“¾ä½ç½®
# - çŸ¥è¯†æ˜Ÿçƒç›¸å…³è°ƒç ”
# - v26å› å­è¯„åˆ†
# - å»ºä»“å»ºè®®
```

### 5.3 è‡ªåŠ¨æŠ¥å‘Šæµç¨‹

**ç¾è‚¡æŠ¥å‘Š (08:30è‡ªåŠ¨)**:
```
å®šæ—¶ä»»åŠ¡è§¦å‘
    â†“
è°ƒç”¨ generate_report_longbridge.py
    â†“
1. é•¿æ¡¥APIè·å–ç¾è‚¡è¡Œæƒ…
2. ç”Ÿæˆåˆ†ææŠ¥å‘Š
3. ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶
4. æ¨é€åˆ°é£ä¹¦ âœ…
```

**A+HæŠ¥å‘Š (09:15è‡ªåŠ¨)**:
```
å®šæ—¶ä»»åŠ¡è§¦å‘
    â†“
è°ƒç”¨ generate_report_longbridge.py
    â†“
1. é•¿æ¡¥APIè·å–Aè‚¡/æ¸¯è‚¡è¡Œæƒ…
2. ç”Ÿæˆå¼€ç›˜å‰ç»
3. ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶
4. æ¨é€åˆ°é£ä¹¦ âœ…
```

---

## å…­ã€è¾“å‡ºæ ¼å¼è§„èŒƒ

### 6.1 äº§ä¸šé“¾åˆ†ææŠ¥å‘Š

```markdown
## ğŸ“Š [è¡Œä¸šåç§°]äº§ä¸šé“¾åˆ†ææŠ¥å‘Š

### ä¸€ã€çŸ¥è¯†æ˜Ÿçƒæœ€æ–°è°ƒç ”
- [æ—¥æœŸ] [æ ‡é¢˜] - [æ ¸å¿ƒç»“è®º]

### äºŒã€å®æ—¶è¡Œæƒ…
| æ ‡çš„ | ä»·æ ¼ | æ¶¨è·Œ | ä»“ä½ |
|:-----|-----:|-----:|-----:|

### ä¸‰ã€äº§ä¸šé“¾åˆ†æ
ä¸Šæ¸¸ â†’ ä¸­æ¸¸ â†’ ä¸‹æ¸¸

### å››ã€æŠ•èµ„å»ºè®®
- ç»¼åˆè¯„åˆ†: +XXåˆ†
- æ¨èç»„åˆ: ...
- å»ºä»“ç­–ç•¥: ...
```

### 6.2 ä¸ªè‚¡åˆ†ææŠ¥å‘Š

```markdown
## ğŸ“Š [è‚¡ç¥¨åç§°] ([ä»£ç ]) æ·±åº¦åˆ†æ

### ä¸€ã€å®æ—¶è¡Œæƒ…
- æœ€æ–°ä»·: XXå…ƒ (+X.XX%)

### äºŒã€äº§ä¸šé“¾ä½ç½®
- ä¸Šæ¸¸/ä¸­æ¸¸/ä¸‹æ¸¸å®šä½

### ä¸‰ã€çŸ¥è¯†æ˜Ÿçƒç›¸å…³è°ƒç ”
- [å¦‚æœæœ‰]

### å››ã€v26å› å­è¯„åˆ†
- ç»¼åˆå¾—åˆ†: +X.XXåˆ†
- å„å› å­æ˜ç»†...

### äº”ã€æŠ•èµ„å»ºè®®
- è¯„çº§: ä¹°å…¥/è§‚æœ›/å–å‡º
- ç›®æ ‡ä»·: XXå…ƒ
- æ­¢æŸä½: -XX%
```

---

## ä¸ƒã€æ•…éšœå¤„ç†

### 7.1 é•¿æ¡¥APIå¤±è´¥

```python
# è‡ªåŠ¨å¤„ç†é€»è¾‘
try:
    quotes = api.get_quotes(symbols)
except Exception as e:
    print(f"âŒ é•¿æ¡¥APIå¤±è´¥: {e}")
    # ä½¿ç”¨T-1æ—¥æ•°æ®
    quotes = get_cached_quotes(symbols)
```

### 7.2 çŸ¥è¯†æ˜ŸçƒAPIå¤±è´¥ (14001)

```python
# é¢‘ç‡é™åˆ¶å¤„ç†
if error_code == 14001:
    print("âš ï¸ çŸ¥è¯†æ˜Ÿçƒé¢‘ç‡é™åˆ¶ï¼Œç­‰å¾…30ç§’åé‡è¯•...")
    time.sleep(30)
    # æˆ–ä½¿ç”¨å·²æœ‰ç¼“å­˜æ•°æ®
```

### 7.3 é£ä¹¦æ¨é€å¤±è´¥

```python
# æ¨é€å¤±è´¥å¤„ç†
try:
    send_feishu_message(report)
except Exception as e:
    print(f"âš ï¸ é£ä¹¦æ¨é€å¤±è´¥: {e}")
    # ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶
    save_to_file(report)
```

---

## å…«ã€æ—¥å¿—ç®¡ç†

### 8.1 æ—¥å¿—æ–‡ä»¶ä½ç½®

```
logs/
â”œâ”€â”€ us_market.log          # ç¾è‚¡æŠ¥å‘Šæ—¥å¿—
â”œâ”€â”€ ah_market.log          # A+HæŠ¥å‘Šæ—¥å¿—
â”œâ”€â”€ zsxq.log               # çŸ¥è¯†æ˜Ÿçƒæ—¥å¿—
â”œâ”€â”€ optimizer.log          # ä¼˜åŒ–å™¨æ—¥å¿—
â”œâ”€â”€ daily_report.log       # æ”¶ç›˜æŠ¥å‘Šæ—¥å¿—
â””â”€â”€ heartbeat.log          # Heartbeatæ—¥å¿—
```

### 8.2 æ—¥å¿—è½®è½¬

```bash
# æ¯å‘¨æ¸…ç†ä¸€æ¬¡æ—§æ—¥å¿—
0 0 * * 0 find ~/.openclaw/workspace/logs -name "*.log" -mtime +7 -delete
```

---

## ä¹ã€å¿«é€Ÿå¼€å§‹

### 9.1 ç¯å¢ƒå‡†å¤‡

```bash
cd ~/.openclaw/workspace
source setup_env.sh
```

### 9.2 æ‰‹åŠ¨æ‰§è¡Œåˆ†æ

```bash
# äº§ä¸šé“¾åˆ†æ
python3 -c "
from skills.dounai_investment_system import DounaiSystem
system = DounaiSystem()
result = system.analyze_industry('å­˜å‚¨èŠ¯ç‰‡')
"

# ä¸ªè‚¡åˆ†æ
python3 -c "
from skills.dounai_investment_system import DounaiSystem
system = DounaiSystem()
result = system.analyze_stock('301421.SZ')
"
```

### 9.3 æŸ¥çœ‹æŠ¥å‘Š

```bash
# ç¾è‚¡æŠ¥å‘Š
cat data/us_market_daily_$(date +%Y%m%d).md

# A+HæŠ¥å‘Š
cat data/ah_market_preopen_$(date +%Y%m%d).md
```

---

## åã€æ‰©å±•å¼€å‘

### 10.1 æ·»åŠ æ–°çš„åˆ†ææ¨¡å—

```python
# åœ¨ skills/dounai-investment-system/__init__.py æ·»åŠ 

def analyze_new_sector(self, sector_name: str):
    """æ–°å¢æ¿å—åˆ†æ"""
    # 1. çŸ¥è¯†æ˜Ÿçƒä¿¡æ¯
    zsxq_data = self.search_zsxq(sector_name)
    
    # 2. å®æ—¶è¡Œæƒ…
    quotes = self.get_industry_quotes(sector_name)
    
    # 3. ç”ŸæˆæŠ¥å‘Š
    return self.generate_report(zsxq_data, quotes)
```

### 10.2 æ·»åŠ æ–°çš„æ•°æ®æº

```python
# åœ¨ tools/ æ·»åŠ æ–°çš„APIå°è£…
# ä¾‹å¦‚: tushare_api.py, eastmoney_api.py
```

---

## åä¸€ã€ç³»ç»ŸçŠ¶æ€

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|:-----|:----:|:-----|
| é•¿æ¡¥API | âœ… å·²é…ç½® | å®æ—¶è¡Œæƒ… |
| çŸ¥è¯†æ˜ŸçƒAPI | âœ… å·²é…ç½® | é¢‘ç‡é™åˆ¶éœ€æ³¨æ„ |
| ç¾è‚¡æŠ¥å‘Š | âœ… å¯ç”¨ | è‡ªåŠ¨æ¨é€åˆ°é£ä¹¦ |
| A+HæŠ¥å‘Š | âœ… å¯ç”¨ | è‡ªåŠ¨æ¨é€åˆ°é£ä¹¦ |
| äº§ä¸šé“¾åˆ†æ | âœ… å¯ç”¨ | æ•´åˆçŸ¥è¯†æ˜Ÿçƒ+è¡Œæƒ… |
| ä¸ªè‚¡åˆ†æ | âœ… å¯ç”¨ | v26å› å­+äº§ä¸šé“¾ |
| å®šæ—¶ä»»åŠ¡ | âœ… å·²é…ç½® | Crontab |
| Heartbeat | âœ… å·²é…ç½® | æ¯30åˆ†é’Ÿ |

---

**ç³»ç»Ÿæ•´åˆå®Œæˆï¼Œå…¨è‡ªåŠ¨è¿è¡Œï¼** ğŸš€
