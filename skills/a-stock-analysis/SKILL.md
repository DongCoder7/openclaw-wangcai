---
name: a-stock-analysis
description: A股个股深度分析Skill。严格遵循10环节分析流程：1.公司基本画像 2.业务结构分析 3.产业链定位 4.订单与产能 5.财务深度分析 6.行业景气度 7.客户与供应商 8.业绩预测与估值 9.风险提示 10.投资建议。支持多源数据获取（Tushare/新浪财经/知识星球）、多源交叉验证、因子重新计算。
---

# A股个股深度分析 Skill v3.0

## 触发条件

当用户要求以下分析时触发：
- "分析[股票名称/代码]"
- "研究[股票]的基本面"
- "深度分析[股票]"
- "看看[股票]怎么样"
- "[股票]的投资价值"

---

## 10环节分析流程 (必须严格遵循)

```
┌─────────────────────────────────────────────────────────────┐
│  1. 公司基本画像 (含多源行情交叉验证)                        │
├─────────────────────────────────────────────────────────────┤
│  2. 业务结构分析 (产品/业务拆分)                            │
├─────────────────────────────────────────────────────────────┤
│  3. 产业链定位与竞争优势 (ASCII流程图)                      │
├─────────────────────────────────────────────────────────────┤
│  4. 订单与产能分析 (含知识星球调研)                          │
├─────────────────────────────────────────────────────────────┤
│  5. 财务深度分析 (杜邦拆解)                                 │
├─────────────────────────────────────────────────────────────┤
│  6. 行业景气度验证 (含知识星球观点)                          │
├─────────────────────────────────────────────────────────────┤
│  7. 客户与供应商分析 (含调研纪要)                            │
├─────────────────────────────────────────────────────────────┤
│  8. 业绩预测与估值 (三情景测算)                              │
├─────────────────────────────────────────────────────────────┤
│  9. 风险提示 (分级标注)                                     │
├─────────────────────────────────────────────────────────────┤
│  10. 投资建议 (含跟踪指标)                                   │
└─────────────────────────────────────────────────────────────┘
```

---

## 数据获取规范

### 多源交叉验证原则

| 数据类型 | 首选源 | 备选源 | 验证方式 |
|:---------|:-------|:-------|:---------|
| **实时行情** | Tushare Pro | 新浪财经API | 价格差异<0.01元 |
| **财务数据** | Tushare: `income` | - | API直接获取 |
| **因子计算** | Tushare日线重算 | - | 不用本地DB |
| **公司公告** | 巨潮资讯网 | 新浪/东财 | 多源尝试 |
| **调研纪要** | 知识星球 | 券商研报 | 标注来源 |

### 因子计算 (必须从Tushare重新计算)

```python
import tushare as ts
import pandas as pd
import numpy as np

def calculate_factors(ts_code):
    """从Tushare日线重新计算因子"""
    pro = ts.pro_api()
    
    # 获取日线
    df = pro.daily(ts_code=ts_code, start_date='20260101', end_date='20260226')
    df = df.sort_values('trade_date')
    
    # 计算因子
    df['ret_20'] = df['close'].pct_change(20)
    df['ret_60'] = df['close'].pct_change(60)
    df['vol_20'] = df['close'].rolling(20).std() / df['close'].rolling(20).mean()
    df['ma_20'] = df['close'].rolling(20).mean()
    df['price_pos_20'] = (df['close'] - df['low'].rolling(20).min()) / \
                         (df['high'].rolling(20).max() - df['low'].rolling(20).min() + 0.001)
    
    return df.iloc[-1]
```

---

## 10环节详细指南

### 环节1: 公司基本画像

**必含内容**:
| 字段 | 信息源 | 输出格式 |
|:-----|:-------|:---------|
| 股票代码 | Tushare: `stock_basic` | 600875.SH |
| 公司名称 | Tushare/新浪验证 | 东方电气 |
| 所属行业 | Tushare | 电气设备 |
| 最新股价 | Tushare+新浪交叉 | 37.35元 ✅ |
| 涨跌幅 | Tushare+新浪交叉 | +10.01% |
| **PE_TTM** | **Tushare: `daily_basic`** | **PE 39.58** |
| **PB** | **Tushare: `daily_basic`** | **PB 2.90** |
| **PS_TTM** | **Tushare: `daily_basic`** | **PS 1.69** |
| 市值 | Tushare: `daily_basic` | 1291.70亿 |
| 核心概念 | Tushare: `concept_detail` | 风电、海风、核电等 |

**验证表格必须输出**:
```markdown
| 数据项 | Tushare | 新浪财经 | 验证结果 |
|:-------|:--------|:---------|:---------|
| 最新价 | 37.35元 | 37.35元 | ✅ 一致 |
| 涨跌幅 | +10.01% | +10.01% | ✅ 一致 |
```

**估值警示**: 如果PE > 100x，必须标注 🔴 极高风险
| 核心概念 | Tushare: `concept_detail` | 风电、海风、核电等 |
| 实际控制人 | Tushare | 国务院国资委 |

**验证表格必须输出**:
```markdown
| 数据项 | Tushare | 新浪财经 | 验证结果 |
|:-------|:--------|:---------|:---------|
| 最新价 | 37.35元 | 37.35元 | ✅ 一致 |
| 涨跌幅 | +10.01% | +10.01% | ✅ 一致 |
```

---

### 环节2: 业务结构分析

**必含内容**:
- 主营业务概述 (一句话)
- 收入结构表格 (产品/占比/状态)
- 核心竞争力分析

**输出模板**:
```markdown
### 2.1 主营业务概述
[一句话描述公司核心业务]

### 2.2 收入结构分析
| 业务类型 | 收入(亿) | 占比 | 状态 | 毛利率 |
|:---------|:---------|:-----|:-----|:-------|
| 业务A | xx | xx% | 🚀/🟡/⚠️ | xx% |
| 业务B | xx | xx% | 🚀/🟡/⚠️ | xx% |

### 2.3 核心竞争力
| 维度 | 竞争优势 | 说明 |
|:-----|:---------|:-----|
| 技术 | ... | ... |
| 客户 | ... | ... |
```

---

### 环节3: 产业链定位

**必含内容**:
- ASCII产业链流程图
- 公司在产业链中的位置
- 竞争格局表格
- 与行业龙头对比

**产业链图模板**:
```markdown
### 3.1 产业链定位

```
┌─────────────────────────────────────────────────────────────┐
│ 上游: [原材料/核心部件]                                       │
│ - [供应商A]、[供应商B]                                       │
├─────────────────────────────────────────────────────────────┤
│ 中游: 【公司所在环节】 ← 核心价值                             │
│ - [公司核心产品]                                             │
├─────────────────────────────────────────────────────────────┤
│ 下游: [应用领域/主要客户]                                     │
│ - [客户A]、[客户B]                                           │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 竞争格局 - 同行业估值对比（Tushare真实数据）

**⚠️ 必须用真实数据，禁止估算！**

**查询方法**:
```python
import tushare as ts
pro = ts.pro_api()
df = pro.daily_basic(trade_date='20260226')
# 筛选同行业公司
df[df['ts_code'].isin(['600875.SH', '601727.SH'])]
```

**数据表格示例**:
| 公司 | 代码 | PE_TTM | PB | 总市值 | 数据来源 |
|:-----|:-----|:-------|:---|:-------|:---------|
| **目标公司** | XXX.XX | **真实值** | X.XX | XX亿 | Tushare Pro |
| 竞争对手A | XXX.XX | 真实值 | X.XX | XX亿 | Tushare Pro |
| 行业平均 | - | 计算值 | - | - | 计算 |

**禁止行为**:
- ❌ 估算或编造PE数值
- ❌ 使用过时的数据
- ❌ 不标注数据来源
```

---

### 环节4: 订单与产能

**必含内容**:
- 订单获取渠道说明
- 已知订单信息
- 产能情况分析
- 在建工程跟踪
- **知识星球/调研纪要信息**

**信息源标注**:
```markdown
| 数据 | 数值 | 信息源 | 获取方式 |
|:-----|:-----|:-------|:---------|
| 在手订单 | xx亿 | 知识星球调研纪要 | 调研/公告 |
| 新签订单 | xx亿 | 公司公告 | 巨潮资讯网 |
| 产能利用率 | xx% | 调研纪要 | 实地调研 |

### 4.4 订单情况（知识星球/调研纪要）
- [具体订单信息，标注来源]
- [客户反馈，标注来源]
```

---

### 环节5: 财务深度分析

**必含内容**:
- 利润表多期对比 (至少3年)
- 盈利能力指标 (毛利率/净利率/ROE)
- 杜邦分析拆解
- 业绩预告 (如有)

**财务表格模板**:
```markdown
### 5.1 利润表分析
| 指标 | 2022A | 2023A | 2024E | 2025Q3 | 趋势 |
|:-----|:------|:------|:------|:-------|:-----|
| 营收 | xx亿 | xx亿 | xx亿 | xx亿 | 🟢/🔴 |
| 净利 | xx亿 | xx亿 | xx亿 | xx亿 | 🟢/🔴 |

### 5.2 杜邦分析
```
ROE = 净利率 × 资产周转率 × 权益乘数
    = xx% × xx × xx
    = xx%
```
```

---

### 环节6: 行业景气度

**必含内容**:
- 行业驱动因素分析
- 行业增长数据
- 龙头业绩对比
- **知识星球行业观点**
- **券商研报行业观点**

**输出模板**:
```markdown
### 6.1 行业驱动因素
| 因素 | 影响 | 说明 |
|:-----|:-----|:-----|
| 因素A | 🟢 | ... |
| 因素B | 🟡 | ... |

### 6.2 行业趋势（知识星球/研报）
- [行业趋势1，标注来源：XX研报/知识星球]
- [行业趋势2，标注来源：XX研报/知识星球]

### 6.3 券商研报行业观点
| 券商 | 观点 | 日期 |
|:-----|:-----|:-----|
| 中信证券 | [核心观点] | 2024-XX |
| 中金公司 | [核心观点] | 2024-XX |
[知识星球调研纪要摘要]
```

---

### 环节7: 客户与供应商

**必含内容**:
- 客户结构表格 (含知识星球数据)
- 供应商结构表格
- 成本结构分析
- 供应链风险提示
- **调研纪要客户/供应商信息**

**客户表格模板**:
```markdown
### 7.1 客户结构
| 客户类型 | 占比 | 代表客户 | 特点 | 信息源 |
|:---------|:-----|:---------|:-----|:-------|
| 类型A | xx% | [客户名] | ... | 知识星球调研 |
| 类型B | xx% | [客户名] | ... | 年报 |

### 7.2 客户调研纪要要点
- [客户反馈1，来源：知识星球调研]
- [客户反馈2，来源：调研纪要]
```

---

### 环节8: 业绩预测与估值

**必含内容**:
- 业绩预测表格 (3年)
- **券商研报观点汇总（必须）**
- 三情景估值测算
- 当前估值评价

**券商研报汇总模板**:
```markdown
### 8.1 券商研报观点汇总
| 券商 | 评级 | 目标价 | 核心观点 | 日期 |
|:-----|:-----|:-------|:---------|:-----|
| 中信证券 | 买入/增持 | xx元 | [核心观点摘要] | 2024-XX |
| 中金公司 | 跑赢/持平 | xx元 | [核心观点摘要] | 2024-XX |
| 广发证券 | 买入/增持 | xx元 | [核心观点摘要] | 2024-XX |
```

**估值表格模板**:
```markdown
### 8.2 三情景估值
| 情景 | 净利润 | 给予PE | 目标价 | 空间 | 评价 |
|:-----|:-------|:-------|:-------|:-----|:-----|
| 保守 | xx亿 | xx倍 | xx元 | xx% | 业绩miss |
| 中性 | xx亿 | xx倍 | xx元 | xx% | 符合预期 |
| 乐观 | xx亿 | xx倍 | xx元 | xx% | 超预期 |
```

---

### 环节9: 风险提示

**必含内容**:
- 风险矩阵表格 (影响程度分级)
- 短期风险
- 中长期风险

**风险表格模板**:
```markdown
| 风险类型 | 影响程度 | 说明 |
|:---------|:---------|:-----|
| 风险A | ⭐⭐⭐⭐⭐ | ... |
| 风险B | ⭐⭐⭐ | ... |
```

---

### 环节10: 投资建议

**必含内容**:
- 投资逻辑评分表
- 明确买入区间
- 目标价与止损价
- 关键跟踪指标

**投资建议模板**:
```markdown
### 10.1 投资建议
| 建议项 | 内容 |
|:-------|:-----|
| 当前状态 | [⚠️ 不宜追高/🟢 可买入/🔴 建议卖出] |
| 买入区间 | xx-xx元 |
| 目标价 | xx元 |
| 止损价 | xx元 |

### 10.2 关键跟踪指标
| 指标 | 频率 | 数据源 |
|:-----|:-----|:-------|
| 指标A | 日度 | Tushare |
| 指标B | 季度 | 知识星球 |
```

---

## 数据源标注规范

**必须在报告末尾标注**:
```markdown
## 数据源汇总

| 来源 | 数据类型 | 具体内容 |
|:-----|:---------|:---------|
| **Tushare Pro** | **估值/财务** | **PE_TTM, PB, PS_TTM, 总市值等** |
| **本地数据库** | **历史价格** | **日线数据，涨跌幅** |
| **长桥API** | **实时行情** | **股价、成交量、成交额** |
| **券商研报** | **观点/预测** | **评级、目标价、核心观点** |
| **知识星球** | **调研纪要** | **订单、客户、产能、行业观点** |
| **公开信息** | **公司资料** | **主营业务、股权结构** |
```

**数据验证要求**:
- 估值数据必须从Tushare Pro获取
- 历史价格必须从本地数据库获取
- 研报观点必须标注券商和日期
- 调研信息必须标注来源

---

## 工具脚本

### 数据获取工具

**tools/stock_data_collector.py**:
```python
#!/usr/bin/env python3
"""
个股数据收集器 - 多源获取
整合Tushare + 新浪财经 + 因子计算
"""

import tushare as ts
import requests
import pandas as pd
import numpy as np
from datetime import datetime, timedelta

class StockDataCollector:
    """个股数据收集器"""
    
    def __init__(self, tushare_token):
        ts.set_token(tushare_token)
        self.pro = ts.pro_api()
    
    def get_price_cross_verify(self, ts_code):
        """多源交叉验证股价"""
        results = {}
        
        # Tushare
        df = self.pro.daily(ts_code=ts_code, limit=1)
        if not df.empty:
            results['tushare'] = df.iloc[0].to_dict()
        
        # 新浪财经
        try:
            code = ts_code.lower().replace('.sz', '').replace('.sh', '')
            prefix = 'sz' if ts_code.endswith('.SZ') else 'sh'
            url = f'https://hq.sinajs.cn/list={prefix}{code}'
            r = requests.get(url, headers={'Referer': 'https://finance.sina.com.cn'})
            data = r.text.split('"')[1].split(',')
            results['sina'] = {'close': float(data[3]), 'name': data[0]}
        except:
            pass
        
        # 验证
        if 'tushare' in results and 'sina' in results:
            diff = abs(results['tushare']['close'] - results['sina']['close'])
            results['verified'] = diff < 0.01
        
        return results
    
    def calculate_factors(self, ts_code, days=60):
        """从Tushare日线重新计算因子"""
        end_date = datetime.now().strftime('%Y%m%d')
        start_date = (datetime.now() - timedelta(days=days)).strftime('%Y%m%d')
        
        df = self.pro.daily(ts_code=ts_code, start_date=start_date, end_date=end_date)
        if df.empty or len(df) < 20:
            return None
        
        df = df.sort_values('trade_date')
        df['ret_20'] = df['close'].pct_change(20)
        df['vol_20'] = df['close'].rolling(20).std() / df['close'].rolling(20).mean()
        df['ma_20'] = df['close'].rolling(20).mean()
        df['price_pos_20'] = (df['close'] - df['low'].rolling(20).min()) / \
                             (df['high'].rolling(20).max() - df['low'].rolling(20).min() + 0.001)
        
        return df.iloc[-1].to_dict()
```

---

## 输出示例

完整报告示例见:
- **标准版**: [examples/sample_report.md](examples/sample_report.md) - 东方电气完整示例
- **多源完整版**: [examples/sample_report_multisource.md](examples/sample_report_multisource.md) - **申菱环境多源数据示例（推荐参考）**

报告必须包含:
1. 10个环节的完整内容
2. **多源数据验证表格（Tushare+本地+研报+调研）**
3. ASCII产业链流程图
4. **同行业估值对比（Tushare数据）**
5. **券商研报观点汇总**
6. **知识星球调研纪要标注**
7. 数据源汇总表格

---

## 质量检查清单

**发布前必须检查**:
- [ ] 10个环节全部覆盖
- [ ] **Tushare估值数据已真实查询（PE_TTM, PB, PS_TTM）**
- [ ] **同行业估值对比使用真实数据，禁止估算**
- [ ] **所有数值必须标注数据来源**
- [ ] 股价多源验证通过
- [ ] ASCII产业链图正确
- [ ] **券商研报观点已汇总**
- [ ] **知识星球/调研纪要信息已标注来源**
- [ ] 买入/目标/止损价逻辑一致
- [ ] **数据源汇总表格完整（含Tushare+本地+研报+调研）**

**数据真实性红线**:
- 🚫 **严禁编造或估算任何财务数据**
- 🚫 **严禁使用过时的数据**
- 🚫 **严禁不标注数据来源**
- ✅ **所有数据必须来自Tushare/数据库/研报/调研**
- ✅ **所有估算必须注明"估算"并说明依据**

---

*版本: v3.0*  
*更新: 2026-02-27*  
*核心: 10环节流程 + 多源验证 + 知识星球整合*
