---
name: a-stock-analysis
description: A股个股深度分析Skill。严格遵循10环节分析流程：1.公司基本画像 2.业务结构分析 3.产业链定位 4.订单与产能 5.财务深度分析 6.行业景气度 7.客户与供应商 8.业绩预测与估值 9.风险提示 10.投资建议。支持多源数据获取（Tushare/新浪财经/知识星球）、多源交叉验证、因子重新计算。
---

# A股个股深度分析 Skill v3.0

## 触发条件

当用户要求以下分析时触发：
- "分析[股票名称/代码]"
- "研究[股票]的基本面"
- "深度分析[股票]"
- "看看[股票]怎么样"
- "[股票]的投资价值"

---

## 10环节分析流程 (必须严格遵循)

```
┌─────────────────────────────────────────────────────────────┐
│  1. 公司基本画像 (含多源行情交叉验证)                        │
├─────────────────────────────────────────────────────────────┤
│  2. 业务结构分析 (产品/业务拆分)                            │
├─────────────────────────────────────────────────────────────┤
│  3. 产业链定位与竞争优势 (ASCII流程图)                      │
├─────────────────────────────────────────────────────────────┤
│  4. 订单与产能分析 (含知识星球调研)                          │
├─────────────────────────────────────────────────────────────┤
│  5. 财务深度分析 (杜邦拆解)                                 │
├─────────────────────────────────────────────────────────────┤
│  6. 行业景气度验证 (含知识星球观点)                          │
├─────────────────────────────────────────────────────────────┤
│  7. 客户与供应商分析 (含调研纪要)                            │
├─────────────────────────────────────────────────────────────┤
│  8. 业绩预测与估值 (三情景测算)                              │
├─────────────────────────────────────────────────────────────┤
│  9. 风险提示 (分级标注)                                     │
├─────────────────────────────────────────────────────────────┤
│  10. 投资建议 (含跟踪指标)                                   │
└─────────────────────────────────────────────────────────────┘
```

---

## 数据获取规范

### 多源交叉验证原则

| 数据类型 | 首选源 | 备选源 | 验证方式 |
|:---------|:-------|:-------|:---------|
| **实时行情** | Tushare Pro | 新浪财经API | 价格差异<0.01元 |
| **财务数据** | Tushare: `income` | - | API直接获取 |
| **因子计算** | Tushare日线重算 | - | 不用本地DB |
| **公司公告** | 巨潮资讯网 | 新浪/东财 | 多源尝试 |
| **调研纪要** | 知识星球 | 券商研报 | 标注来源 |

### ⚠️ 单位转换规范（极易出错！）

**Tushare Pro 字段单位**:

| 字段 | 单位 | 转换方式 | 示例 |
|:-----|:-----|:---------|:-----|
| `total_mv` (总市值) | **万元** | ÷ 10000 = 亿元 | 4766946 → 476.69亿 |
| `circ_mv` (流通市值) | **万元** | ÷ 10000 = 亿元 | 4324727 → 432.47亿 |
| `total_revenue` (营收) | **元** | ÷ 100000000 = 亿元 | 3604963000 → 36.05亿 |
| `n_income` (净利润) | **元** | ÷ 100000000 = 亿元 | 273678000 → 2.74亿 |
| `amount` (成交额) | **千元** | ÷ 100000 = 亿元 | - |

**验证方法**:
```python
df = pro.daily_basic(ts_code='300666.SZ', trade_date='20260226')
mv_yi = df['total_mv'].values[0] / 10000  # 万元→亿元
print(f"总市值: {mv_yi:.2f}亿元")
```

**常见错误**:
- ❌ 错误: `total_mv / 1e8` (当成元处理)
- ✅ 正确: `total_mv / 1e4` (实际是万元)

### 因子计算 (必须从Tushare重新计算)

```python
import tushare as ts
import pandas as pd
import numpy as np

def calculate_factors(ts_code):
    """从Tushare日线重新计算因子"""
    pro = ts.pro_api()
    
    # 获取日线
    df = pro.daily(ts_code=ts_code, start_date='20260101', end_date='20260226')
    df = df.sort_values('trade_date')
    
    # 计算因子
    df['ret_20'] = df['close'].pct_change(20)
    df['ret_60'] = df['close'].pct_change(60)
    df['vol_20'] = df['close'].rolling(20).std() / df['close'].rolling(20).mean()
    df['ma_20'] = df['close'].rolling(20).mean()
    df['price_pos_20'] = (df['close'] - df['low'].rolling(20).min()) / \
                         (df['high'].rolling(20).max() - df['low'].rolling(20).min() + 0.001)
    
    return df.iloc[-1]
```

---

## 10环节详细指南

### 环节1: 公司基本画像

**必含内容**:
| 字段 | 信息源 | 输出格式 |
|:-----|:-------|:---------|
| 股票代码 | Tushare: `stock_basic` | 600875.SH |
| 公司名称 | Tushare/新浪验证 | 东方电气 |
| 所属行业 | Tushare | 电气设备 |
| 最新股价 | Tushare+新浪交叉 | 37.35元 ✅ |
| 涨跌幅 | Tushare+新浪交叉 | +10.01% |
| **PE_TTM** | **Tushare: `daily_basic`** | **PE 39.58** |
| **PB** | **Tushare: `daily_basic`** | **PB 2.90** |
| **PS_TTM** | **Tushare: `daily_basic`** | **PS 1.69** |
| 市值 | Tushare: `daily_basic` | 1291.70亿 |
| 核心概念 | Tushare: `concept_detail` | 风电、海风、核电等 |

**验证表格必须输出**:
```markdown
| 数据项 | Tushare | 新浪财经 | 验证结果 |
|:-------|:--------|:---------|:---------|
| 最新价 | 37.35元 | 37.35元 | ✅ 一致 |
| 涨跌幅 | +10.01% | +10.01% | ✅ 一致 |
```

**估值警示**: 如果PE > 100x，必须标注 🔴 极高风险
| 核心概念 | Tushare: `concept_detail` | 风电、海风、核电等 |
| 实际控制人 | Tushare | 国务院国资委 |

**验证表格必须输出**:
```markdown
| 数据项 | Tushare | 新浪财经 | 验证结果 |
|:-------|:--------|:---------|:---------|
| 最新价 | 37.35元 | 37.35元 | ✅ 一致 |
| 涨跌幅 | +10.01% | +10.01% | ✅ 一致 |
```

---

### 环节2: 业务结构分析

**必含内容**:
- 主营业务概述 (一句话)
- 收入结构表格 (产品/占比/状态)
- 核心竞争力分析

**输出模板**:
```markdown
### 2.1 主营业务概述
[一句话描述公司核心业务]

### 2.2 收入结构分析
| 业务类型 | 收入(亿) | 占比 | 状态 | 毛利率 |
|:---------|:---------|:-----|:-----|:-------|
| 业务A | xx | xx% | 🚀/🟡/⚠️ | xx% |
| 业务B | xx | xx% | 🚀/🟡/⚠️ | xx% |

### 2.3 核心竞争力
| 维度 | 竞争优势 | 说明 |
|:-----|:---------|:-----|
| 技术 | ... | ... |
| 客户 | ... | ... |
```

---

### 环节3: 产业链定位

**必含内容**:
- ASCII产业链流程图
- 公司在产业链中的位置
- 竞争格局表格
- 与行业龙头对比

**产业链图模板**:
```markdown
### 3.1 产业链定位

```
┌─────────────────────────────────────────────────────────────┐
│ 上游: [原材料/核心部件]                                       │
│ - [供应商A]、[供应商B]                                       │
├─────────────────────────────────────────────────────────────┤
│ 中游: 【公司所在环节】 ← 核心价值                             │
│ - [公司核心产品]                                             │
├─────────────────────────────────────────────────────────────┤
│ 下游: [应用领域/主要客户]                                     │
│ - [客户A]、[客户B]                                           │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 竞争格局 - 同行业估值对比（Tushare真实数据）

**⚠️ 同行业选择原则**:
1. **同业务优先**: 直接竞争对手（产品相同/相似）
2. **同产业链**: 上下游关联公司
3. **同逻辑**: 同赛道不同细分（如都是半导体材料国产替代）
4. **标注差异**: 必须说明可比性和差异点

**江丰电子案例分析**:
- ❌ 错误: 对比安集科技（抛光液，业务不同）
- ✅ 正确: 对比阿石创（PVD镀膜材料，薄膜材料相关）
- ✅ 正确: 对比隆华科技（有ITO靶材业务）
- ⚠️ 注意: 江丰是靶材绝对龙头，A股无直接同等规模竞争对手

**查询方法**:
```python
# 1. 先确认目标公司主营业务
df_basic = pro.stock_basic(ts_code='300666.SZ')
print(df_basic['industry'])  # 半导体
print(df_basic['fullname'])  # 宁波江丰电子材料股份有限公司

# 2. 查找同业务公司（通过行业分类或关键词）
df_all = pro.stock_basic()
df_same_industry = df_all[df_all['industry'] == '半导体']

# 3. 人工筛选真正同业务的公司
# 江丰电子：高纯溅射靶材
# 阿石创（300706）：PVD镀膜材料
# 隆华科技（300263）：ITO靶材
```

**数据表格示例**:
| 公司 | 代码 | PE_TTM | PB | 总市值 | 主营业务 | 可比性说明 |
|:-----|:-----|:-------|:---|:-------|:---------|:-----------|
| **江丰电子** | 300666.SZ | **84.06** | 8.89 | 432亿 | **高纯溅射靶材** | - |
| 阿石创 | 300706.SZ | 亏损 | 10.23 | 72亿 | PVD镀膜材料 | ⭐⭐⭐ 薄膜材料相关，规模差距大 |
| 隆华科技 | 300263.SZ | 81.40 | 3.04 | 128亿 | ITO靶材/电子新材料 | ⭐⭐⭐ 有靶材业务，规模较小 |

**对比结论必须包含**:
1. 可比性分析（为什么可以对比）
2. 差异性说明（为什么不能直接对比）
3. 投资逻辑提炼（江丰的独特优势）
```

---

### 环节4: 订单与产能

**必含内容**:
- 订单获取渠道说明
- 已知订单信息
- 产能情况分析
- 在建工程跟踪
- **知识星球/调研纪要信息**

**信息源标注**:
```markdown
| 数据 | 数值 | 信息源 | 获取方式 |
|:-----|:-----|:-------|:---------|
| 在手订单 | xx亿 | 知识星球调研纪要 | 调研/公告 |
| 新签订单 | xx亿 | 公司公告 | 巨潮资讯网 |
| 产能利用率 | xx% | 调研纪要 | 实地调研 |

### 4.4 订单情况（知识星球/调研纪要）
- [具体订单信息，标注来源]
- [客户反馈，标注来源]
```

---

### 环节5: 财务深度分析

**必含内容**:
- 利润表多期对比 (至少3年)
- 盈利能力指标 (毛利率/净利率/ROE)
- 杜邦分析拆解
- 业绩预告 (如有)

**财务表格模板**:
```markdown
### 5.1 利润表分析
| 指标 | 2022A | 2023A | 2024E | 2025Q3 | 趋势 |
|:-----|:------|:------|:------|:-------|:-----|
| 营收 | xx亿 | xx亿 | xx亿 | xx亿 | 🟢/🔴 |
| 净利 | xx亿 | xx亿 | xx亿 | xx亿 | 🟢/🔴 |

### 5.2 杜邦分析
```
ROE = 净利率 × 资产周转率 × 权益乘数
    = xx% × xx × xx
    = xx%
```
```

---

### 环节6: 行业景气度

**必含内容**:
- 行业驱动因素分析
- 行业增长数据
- 龙头业绩对比
- **知识星球行业观点**
- **券商研报行业观点**

**输出模板**:
```markdown
### 6.1 行业驱动因素
| 因素 | 影响 | 说明 |
|:-----|:-----|:-----|
| 因素A | 🟢 | ... |
| 因素B | 🟡 | ... |

### 6.2 行业趋势（知识星球/研报）
- [行业趋势1，标注来源：XX研报/知识星球]
- [行业趋势2，标注来源：XX研报/知识星球]

### 6.3 券商研报行业观点
| 券商 | 观点 | 日期 |
|:-----|:-----|:-----|
| 中信证券 | [核心观点] | 2024-XX |
| 中金公司 | [核心观点] | 2024-XX |
[知识星球调研纪要摘要]
```

---

### 环节7: 客户与供应商

**必含内容**:
- 客户结构表格 (含知识星球数据)
- 供应商结构表格
- 成本结构分析
- 供应链风险提示
- **调研纪要客户/供应商信息**

**客户表格模板**:
```markdown
### 7.1 客户结构
| 客户类型 | 占比 | 代表客户 | 特点 | 信息源 |
|:---------|:-----|:---------|:-----|:-------|
| 类型A | xx% | [客户名] | ... | 知识星球调研 |
| 类型B | xx% | [客户名] | ... | 年报 |

### 7.2 客户调研纪要要点
- [客户反馈1，来源：知识星球调研]
- [客户反馈2，来源：调研纪要]
```

---

### 环节8: 业绩预测与估值

**必含内容**:
- 业绩预测表格 (3年)
- **券商研报观点汇总（必须）**
- 三情景估值测算
- 当前估值评价
- **⚠️ 研报信息时效性标注**

**研报信息获取渠道**:
| 渠道 | 可获取内容 | 时效性 | 可信度 |
|:-----|:-----------|:-------|:-------|
| **知识星球** | 调研纪要、机构观点 | 最新 | ⭐⭐⭐⭐⭐ |
| **券商APP** | 研报原文、目标价 | 最新 | ⭐⭐⭐⭐⭐ |
| **Tushare** | 研报摘要（有限） | 滞后 | ⭐⭐⭐ |
| **公开信息** | 研报观点汇总 | 滞后 | ⭐⭐⭐ |

**⚠️ 重要提醒**:
- 公开API获取研报信息受限
- 如无法获取最新研报，需**明确标注信息来源和时效性**
- 建议标注："以下研报信息基于2024年公开研报整理，2025年最新研报需通过知识星球/券商APP获取"

**券商研报汇总模板**:
```markdown
### 8.1 券商研报观点汇总

⚠️ **信息来源说明**: [明确标注研报时效性和来源]

| 券商 | 评级 | 目标价 | 核心观点 | 日期 | 信息源 |
|:-----|:-----|:-------|:---------|:-----|:-------|
| 中信证券 | 买入 | 158元 | ... | 2024-12 | 公开研报 |
| 中金公司 | 跑赢行业 | 165元 | ... | 2024-11 | 公开研报 |
```

**估值表格模板**:
```markdown
### 8.2 三情景估值
| 情景 | 净利润 | 给予PE | 目标价 | 空间 | 评价 |
|:-----|:-------|:-------|:-------|:-----|:-----|
| 保守 | xx亿 | xx倍 | xx元 | xx% | 业绩miss |
| 中性 | xx亿 | xx倍 | xx元 | xx% | 符合预期 |
| 乐观 | xx亿 | xx倍 | xx元 | xx% | 超预期 |
```

### 8.4 信息缺失说明（如适用）
| 缺失项 | 原因 | 建议获取方式 |
|:-------|:-----|:-------------|
| 2025年最新研报 | 公开API受限 | 知识星球、券商APP |

---

### 环节9: 风险提示

**必含内容**:
- 风险矩阵表格 (影响程度分级)
- 短期风险
- 中长期风险

**风险表格模板**:
```markdown
| 风险类型 | 影响程度 | 说明 |
|:---------|:---------|:-----|
| 风险A | ⭐⭐⭐⭐⭐ | ... |
| 风险B | ⭐⭐⭐ | ... |
```

---

### 环节10: 投资建议

**必含内容**:
- 投资逻辑评分表
- 明确买入区间
- 目标价与止损价
- 关键跟踪指标

**投资建议模板**:
```markdown
### 10.1 投资建议
| 建议项 | 内容 |
|:-------|:-----|
| 当前状态 | [⚠️ 不宜追高/🟢 可买入/🔴 建议卖出] |
| 买入区间 | xx-xx元 |
| 目标价 | xx元 |
| 止损价 | xx元 |

### 10.2 关键跟踪指标
| 指标 | 频率 | 数据源 |
|:-----|:-----|:-------|
| 指标A | 日度 | Tushare |
| 指标B | 季度 | 知识星球 |
```

---

## 数据源标注规范

**必须在报告末尾标注**:
```markdown
## 数据源汇总

| 来源 | 数据类型 | 具体内容 |
|:-----|:---------|:---------|
| **Tushare Pro** | **估值/财务** | **PE_TTM, PB, PS_TTM, 总市值等** |
| **本地数据库** | **历史价格** | **日线数据，涨跌幅** |
| **长桥API** | **实时行情** | **股价、成交量、成交额** |
| **券商研报** | **观点/预测** | **评级、目标价、核心观点** |
| **知识星球** | **调研纪要** | **订单、客户、产能、行业观点** |
| **公开信息** | **公司资料** | **主营业务、股权结构** |
```

**数据验证要求**:
- 估值数据必须从Tushare Pro获取
- 历史价格必须从本地数据库获取
- 研报观点必须标注券商和日期
- 调研信息必须标注来源

---

## 工具脚本

### 数据获取工具

**tools/stock_data_collector.py**:
```python
#!/usr/bin/env python3
"""
个股数据收集器 - 多源获取
整合Tushare + 新浪财经 + 因子计算
"""

import tushare as ts
import requests
import pandas as pd
import numpy as np
from datetime import datetime, timedelta

class StockDataCollector:
    """个股数据收集器"""
    
    def __init__(self, tushare_token):
        ts.set_token(tushare_token)
        self.pro = ts.pro_api()
    
    def get_price_cross_verify(self, ts_code):
        """多源交叉验证股价"""
        results = {}
        
        # Tushare
        df = self.pro.daily(ts_code=ts_code, limit=1)
        if not df.empty:
            results['tushare'] = df.iloc[0].to_dict()
        
        # 新浪财经
        try:
            code = ts_code.lower().replace('.sz', '').replace('.sh', '')
            prefix = 'sz' if ts_code.endswith('.SZ') else 'sh'
            url = f'https://hq.sinajs.cn/list={prefix}{code}'
            r = requests.get(url, headers={'Referer': 'https://finance.sina.com.cn'})
            data = r.text.split('"')[1].split(',')
            results['sina'] = {'close': float(data[3]), 'name': data[0]}
        except:
            pass
        
        # 验证
        if 'tushare' in results and 'sina' in results:
            diff = abs(results['tushare']['close'] - results['sina']['close'])
            results['verified'] = diff < 0.01
        
        return results
    
    def calculate_factors(self, ts_code, days=60):
        """从Tushare日线重新计算因子"""
        end_date = datetime.now().strftime('%Y%m%d')
        start_date = (datetime.now() - timedelta(days=days)).strftime('%Y%m%d')
        
        df = self.pro.daily(ts_code=ts_code, start_date=start_date, end_date=end_date)
        if df.empty or len(df) < 20:
            return None
        
        df = df.sort_values('trade_date')
        df['ret_20'] = df['close'].pct_change(20)
        df['vol_20'] = df['close'].rolling(20).std() / df['close'].rolling(20).mean()
        df['ma_20'] = df['close'].rolling(20).mean()
        df['price_pos_20'] = (df['close'] - df['low'].rolling(20).min()) / \
                             (df['high'].rolling(20).max() - df['low'].rolling(20).min() + 0.001)
        
        return df.iloc[-1].to_dict()
```

---

## 输出示例

完整报告示例见:
- **标准版**: [examples/sample_report.md](examples/sample_report.md) - 东方电气完整示例
- **多源完整版**: [examples/sample_report_multisource.md](examples/sample_report_multisource.md) - **申菱环境多源数据示例（推荐参考）**

报告必须包含:
1. 10个环节的完整内容
2. **多源数据验证表格（Tushare+本地+研报+调研）**
3. ASCII产业链流程图
4. **同行业估值对比（Tushare数据）**
5. **券商研报观点汇总**
6. **知识星球调研纪要标注**
7. 数据源汇总表格

---

## 质量检查清单

**发布前必须检查**:
- [ ] 10个环节全部覆盖
- [ ] **Tushare估值数据已真实查询（PE_TTM, PB, PS_TTM）**
- [ ] **总市值单位正确（万元→亿元，除以10000）**
- [ ] **财务数据单位正确（元→亿元，除以1e8）**
- [ ] **同行业估值对比使用真实数据，禁止估算**
- [ ] **所有数值必须标注数据来源**
- [ ] 股价多源验证通过
- [ ] ASCII产业链图正确
- [ ] **券商研报观点已汇总**
- [ ] **知识星球/调研纪要信息已标注来源**
- [ ] 买入/目标/止损价逻辑一致
- [ ] **数据源汇总表格完整（含Tushare+本地+研报+调研）**

**数据真实性红线**:
- 🚫 **严禁编造或估算任何财务数据**
- 🚫 **严禁使用过时的数据**
- 🚫 **严禁不标注数据来源**
- 🚫 **严禁单位转换错误（市值万元、财务元）**
- ✅ **所有数据必须来自Tushare/数据库/研报/调研**
- ✅ **所有估算必须注明"估算"并说明依据**
- ✅ **必须验证单位转换（市值=万元÷10000，财务=元÷1e8）**

---

*版本: v3.0*  
*更新: 2026-02-27*  
*核心: 10环节流程 + 多源验证 + 知识星球整合*

---

## 📝 常见问题与解决方案（江丰电子案例分析）

### 问题1: 单位转换错误

**错误表现**:
- 安集科技市值显示为186亿（实际476.69亿）
- 江丰电子市值显示为0.04亿（实际432.47亿）

**原因**: Tushare `total_mv` 单位是**万元**，不是元

**解决方案**:
```python
# ❌ 错误
total_mv / 1e8  # 当成元处理

# ✅ 正确
total_mv / 1e4  # 实际是万元，转为亿元
```

### 问题2: 研报数据获取不全

**错误表现**:
- 研报信息都是2024年的，缺少2025年最新研报
- 没有目标价数据

**原因**: 未使用Tushare `report_rc` 接口

**解决方案**:
```python
# 获取个股研报
df = pro.report_rc(ts_code='300666.SZ')

# 筛选2025-2026年研报
df_recent = df[df['report_date'] >= '20250101']

# 提取目标价（注意检查NaN）
target_price = df['max_price']  # 可能为NaN
```

**江丰电子案例数据**:
- 2025-2026年研报: **120条**
- 平均目标价: **229.2元**
- 最新研报: 2026-02-23

### 问题3: 研报时效性未标注

**错误表现**:
- 研报来源不明确，用户质疑时效性

**解决方案**:
```markdown
⚠️ **信息来源说明**: 以下研报信息基于2025-2026年Tushare Pro数据

| 券商 | 评级 | 目标价 | 日期 |
|:-----|:-----|:-------|:-----|
| 国信证券 | 优于大市 | 208-229元 | 2025-07 |
```

### 问题4: 业绩预测不合理

**错误表现**:
- 2026年营收和净利润增速几乎相同（都是29%）

**正确逻辑**:
- 净利润增速应该 > 营收增速（经营杠杆效应）
- 净利率持续提升：7.6% → 11% → 13%

### 数据验证清单（新增）

**必须验证**:
- [ ] 市值单位：万元 → 亿元（÷10000）
- [ ] 财务单位：元 → 亿元（÷1e8）
- [ ] 研报日期：筛选2025-2026年最新
- [ ] 目标价：检查是否为NaN，去重
- [ ] 业绩预测：净利润增速 > 营收增速

### 江丰电子案例核心发现

1. **单位错误**: 市值单位转换错误（已修复）
2. **研报更新**: 发现120条2025-2026年研报，目标价229元（+41%空间）
3. **战略升级**: 从单一靶材到"靶材+零部件"双轮驱动
4. **业绩强劲**: 2024营收+38.5%，2025Q3净利+39.7%
5. **投资评级**: 从"持有"上调至"买入"
