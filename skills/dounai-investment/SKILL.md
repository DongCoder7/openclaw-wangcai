# è±†å¥¶æŠ•èµ„ç­–ç•¥ç³»ç»Ÿ v2.0

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å±‚ (Data Layer)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  stock_factors        â”‚  stock_valuation    â”‚  å®æ—¶æ•°æ®      â”‚
â”‚  - 15ä¸ªæŠ€æœ¯å› å­        â”‚  - PE/PB/å¸‚å€¼        â”‚  - è…¾è®¯API     â”‚
â”‚  - 5,124åªè‚¡ç¥¨        â”‚  - 5,448åªè‚¡ç¥¨       â”‚                â”‚
â”‚  - 1996-2026          â”‚  - å®æ—¶æ›´æ–°          â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å› å­å±‚ (Factor Library)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6å¤§ç±»32ä¸ªå› å­                                               â”‚
â”‚  â”œâ”€â”€ ä»·å€¼å› å­ (6ä¸ª): PE_TTM, PB_TTM, PS_TTM, åˆ†ä½æ•°, è‚¡æ¯ç‡   â”‚
â”‚  â”œâ”€â”€ è´¨é‡å› å­ (7ä¸ª): ROE, ROA, æ¯›åˆ©ç‡, å¢é•¿ç‡, è´Ÿå€ºç‡        â”‚
â”‚  â”œâ”€â”€ åŠ¨é‡å› å­ (8ä¸ª): 20/60/120æ—¥æ”¶ç›Š, åŠ¨é‡åŠ é€Ÿ, ä»·æ ¼ä½ç½®     â”‚
â”‚  â”œâ”€â”€ æ³¢åŠ¨å› å­ (5ä¸ª): 20/60æ—¥æ³¢åŠ¨ç‡, æœ€å¤§å›æ’¤, ä¸‹è¡Œæ³¢åŠ¨       â”‚
â”‚  â”œâ”€â”€ æµåŠ¨æ€§å› å­ (4ä¸ª): æ¢æ‰‹ç‡, å¸‚å€¼, æˆäº¤é¢, Amihud         â”‚
â”‚  â””â”€â”€ æƒ…ç»ªå› å­ (2ä¸ª): èµ„é‡‘æµå‘, å‡€æµå…¥æ¯”ç‡                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¨¡å‹å±‚ (Model Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¤šå› å­è¯„åˆ†æ¨¡å‹ v2.0                                         â”‚
â”‚  â”œâ”€â”€ ä»·å€¼å› å­ (35%): PE/PBè´Ÿå‘, å°å¸‚å€¼                      â”‚
â”‚  â”œâ”€â”€ åŠ¨é‡å› å­ (35%): 20/60æ—¥æ”¶ç›Š, åŠ¨é‡åŠ é€Ÿ                   â”‚
â”‚  â”œâ”€â”€ è´¨é‡å› å­ (10%): æ”¶ç›ŠåŠ¨é‡                               â”‚
â”‚  â”œâ”€â”€ æ³¢åŠ¨å› å­ (10%): æ³¢åŠ¨ç‡/é‡æ¯”è´Ÿå‘                        â”‚
â”‚  â””â”€â”€ æƒ…ç»ªå› å­ (10%): èµ„é‡‘æµå‘                               â”‚
â”‚                                                              â”‚
â”‚  ç‰¹æ€§: å¸‚å€¼ä¸­æ€§åŒ–, å¼‚å¸¸å€¼è¿‡æ»¤, æ’åæ ‡å‡†åŒ–                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å›æµ‹å±‚ (Backtest Layer)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  äº‹ä»¶é©±åŠ¨å›æµ‹å¼•æ“                                            â”‚
â”‚  â”œâ”€â”€ å®šæœŸè°ƒä»“ (é»˜è®¤20æ—¥)                                    â”‚
â”‚  â”œâ”€â”€ é£æ§æ¨¡å—: æ­¢æŸ(-8%), æ­¢ç›ˆ(+15%)                        â”‚
â”‚  â”œâ”€â”€ äº¤æ˜“æˆæœ¬: æ»‘ç‚¹+ä½£é‡‘                                    â”‚
â”‚  â””â”€â”€ ç»©æ•ˆåˆ†æ: æ”¶ç›Šç‡/å¤æ™®/å›æ’¤/èƒœç‡                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒå·¥å…·

### 1. æ•°æ®è·å– Skill
`skills/historical-data-fetcher/`

```bash
# æµ‹è¯•æ•°æ®æº
python3 skills/historical-data-fetcher/test_sources.py

# è·å–å®æ—¶ä¼°å€¼æ•°æ® (PE/PB)
python3 skills/historical-data-fetcher/fetch_valuation_data.py --all

# æŸ¥çœ‹æ•°æ®æ¦‚å†µ
python3 skills/historical-data-fetcher/fetch_factors.py --summary
```

**å½“å‰æ•°æ®è¦†ç›–**:
- **æŠ€æœ¯å› å­**: 5,124åªè‚¡ç¥¨, 15ä¸ªå› å­, 1996-2026
- **ä¼°å€¼æ•°æ®**: 5,448åªè‚¡ç¥¨, PE/PB/å¸‚å€¼, å®æ—¶æ›´æ–°
- **æ€»è®°å½•æ•°**: 1,080,492æ¡

### 2. å› å­åº“
`tools/factor_library.py`

```python
from factor_library import FactorLibrary, DataLoader

library = FactorLibrary()
loader = DataLoader()

# è·å–åŒ…å«ä¼°å€¼çš„æ•°æ®
df = loader.get_stock_data_with_valuation()

# è®¡ç®—æ‰€æœ‰å› å­
df = library.calc_all_factors(df)
```

### 3. å¤šå› å­é€‰è‚¡ v2.0
`tools/multi_factor_model.py`

```bash
# å®Œæ•´ç‰ˆ (å«PE/PBä¼°å€¼å› å­)
python3 tools/multi_factor_model.py --top 50 --report

# è½»é‡ç‰ˆ (ä»…æŠ€æœ¯å› å­)
python3 tools/multi_factor_model.py --top 50 --lite
```

**å› å­é…ç½® (v2.0)**:
```python
DEFAULT_FACTORS_FULL = {
    # ä»·å€¼å› å­ 35%
    'pe_ttm': {'weight': 0.15, 'direction': -1},
    'pb_ttm': {'weight': 0.10, 'direction': -1},
    'market_cap': {'weight': 0.10, 'direction': -1},
    
    # åŠ¨é‡å› å­ 35%
    'ret_20': {'weight': 0.12, 'direction': 1},
    'ret_60': {'weight': 0.10, 'direction': 1},
    'momentum_accel': {'weight': 0.08, 'direction': 1},
    'relative_strength': {'weight': 0.05, 'direction': 1},
    
    # è´¨é‡å› å­ 10%
    'profit_mom': {'weight': 0.10, 'direction': 1},
    
    # æ³¢åŠ¨å› å­ 10%
    'volatility_20': {'weight': 0.05, 'direction': -1},
    'vol_ratio': {'weight': 0.05, 'direction': -1},
    
    # æƒ…ç»ªå› å­ 10%
    'money_flow_20': {'weight': 0.10, 'direction': 1},
}
```

### 4. ç­–ç•¥å›æµ‹
`tools/backtest_engine.py`

```bash
python3 tools/backtest_engine.py \
    --start 20241001 \
    --end 20241130 \
    --rebalance 20 \
    --positions 20
```

## å›æµ‹ç»“æœ

### ç‰›å¸‚è¡¨ç° (2024/10-11)
```
åˆå§‹èµ„é‡‘: 1,000,000
æœŸæœ«èµ„äº§: 1,176,301

ğŸ“ˆ æ€»æ”¶ç›Šç‡: +17.63%
ğŸ“ˆ å¹´åŒ–æ”¶ç›Š: +212.60%
ğŸ“Š å¤æ™®æ¯”ç‡: 10.80
ğŸ“‰ æœ€å¤§å›æ’¤: -4.53%
ğŸ¯ æ—¥èƒœç‡: 82.1%
ğŸ”„ äº¤æ˜“æ¬¡æ•°: 65
```

### ç†Šå¸‚è¡¨ç° (2024/12-2025/02)
```
åˆå§‹èµ„é‡‘: 1,000,000
æœŸæœ«èµ„äº§: 855,926

ğŸ“‰ æ€»æ”¶ç›Šç‡: -14.41%
ğŸ“‰ å¹´åŒ–æ”¶ç›Š: -49.13%
ğŸ“Š å¤æ™®æ¯”ç‡: -3.30
ğŸ“‰ æœ€å¤§å›æ’¤: -16.31%
ğŸ¯ æ—¥èƒœç‡: 37.0%
```

**ç»“è®º**: ç­–ç•¥åœ¨ç‰›å¸‚è¡¨ç°ä¼˜ç§€ï¼Œç†Šå¸‚éœ€ä¼˜åŒ–ã€‚

## ä½¿ç”¨æ–¹æ³•

### æ¯æ—¥é€‰è‚¡æµç¨‹
```bash
# 1. æ›´æ–°ä¼°å€¼æ•°æ®
python3 skills/historical-data-fetcher/fetch_valuation_data.py --fetch

# 2. è¿è¡Œé€‰è‚¡
python3 tools/multi_factor_model.py --top 30 --report

# 3. æŸ¥çœ‹ç»“æœ
cat /root/.openclaw/workspace/data/selected_stocks_YYYYMMDD.csv
```

### å›æµ‹éªŒè¯
```bash
# å›æµ‹ç‰¹å®šæ—¶æœŸ
python3 tools/backtest_engine.py --start 20240101 --end 20241231

# æŸ¥çœ‹ç»“æœ
cat /root/.openclaw/workspace/data/backtest_result_*.json
```

## æ•°æ®è¯´æ˜

### Available Factors (15ä¸ª)
```python
# æ”¶ç›Šç‡
'ret_20', 'ret_60', 'ret_120'

# æ³¢åŠ¨
'vol_20', 'vol_ratio', 'vol_ratio_amt'

# å‡çº¿
'ma_20', 'ma_60'

# ä»·æ ¼ä½ç½®
'price_pos_20', 'price_pos_60', 'price_pos_high'

# æƒ…ç»ª
'money_flow', 'rel_strength', 'mom_accel', 'profit_mom'
```

### Available Valuation Data
```python
'pe'          # å¸‚ç›ˆç‡TTM
'pb'          # å¸‚å‡€ç‡
'market_cap'  # æ€»å¸‚å€¼
```

## æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **é˜²å¾¡å› å­**: åŠ å…¥ä½æ³¢åŠ¨ã€é«˜è‚¡æ¯å› å­åº”å¯¹ç†Šå¸‚
2. **è¡Œä¸šä¸­æ€§åŒ–**: æŒ‰ç”³ä¸‡è¡Œä¸šåˆ†ç±»ï¼Œé¿å…è¡Œä¸šé›†ä¸­
3. **åŠ¨æ€æƒé‡**: æ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´å› å­æƒé‡
4. **æ›´å¤šæ•°æ®æº**: æ¥å…¥AKShareè·å–è´¢åŠ¡æ•°æ®ï¼ˆROE/å¢é•¿ç‡ï¼‰
5. **æœºå™¨å­¦ä¹ **: å› å­IC/IRåˆ†æï¼ŒåŠ¨æ€é€‰æ‹©æœ‰æ•ˆå› å­

## References

- **æ•°æ®è·å–Skill**: `skills/historical-data-fetcher/`
- **å› å­åº“**: `tools/factor_library.py`
- **å¤šå› å­æ¨¡å‹**: `tools/multi_factor_model.py`
- **å›æµ‹å¼•æ“**: `tools/backtest_engine.py`
