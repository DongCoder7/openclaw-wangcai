# HEARTBEAT.md - Operation Alpha 心跳任务清单

## 每次心跳检查（每10分钟）

### 1. 检查定时任务状态
- 确认 `us-market-overview` (8:30) 任务正常
- 确认 `ah-market-preopen` (9:15) 任务正常
- 检查是否有任务运行失败

### 2. Git同步检查（整点任务）
**触发条件：分钟数为 00-09（整点）**

**执行步骤**：
1. 运行自动同步脚本：`bash tools/git_sync.sh`
2. 脚本会自动检测变更、提交并push
3. 查看日志确认同步状态：`tail -20 .git-sync.log`

**说明**：
- 所有 `.md` 文件变更会自动提交
- 如配置了远程仓库，会自动push
- 同步日志保存在 `.git-sync.log`

**首次使用需配置远程仓库**（可选）：
```bash
git remote add origin https://github.com/yourusername/openclaw-workspace.git
git push -u origin master
```

### 2. 环境就绪检查
- 检查 `.openclaw/workshop/data/` 目录可写
- 检查网络连接（Yahoo Finance、AKShare 等数据源）
- 检查 Python 环境（pandas, numpy, akshare, yfinance 等包）

### 3. VQM策略交易监控（每10分钟）- 必须执行

**VQM策略简介**：
- 策略类型：价值质量多因子（PE 60% + ROE 40%）
- 持仓数量：10只股票等权重
- 初始资金：100万模拟盘
- 调仓频率：月度（月末最后一个交易日）
- 止损线：-12%

**执行命令**：
```bash
python3 tools/vqm_trading_monitor.py
```

**每10分钟检查项（必须执行）**：

#### 3.1 交易时间检查
```
交易日：9:30-11:30, 13:00-15:00
非交易时间：跳过交易检查，只记录净值
```

#### 3.2 T+1卖出限制检查
```
买入日期：2026-02-13（今日）
可卖出日期：2026-02-14（明日）→ 春节期间休市，实际02.24可卖

规则：
- 今日买入的股票，最早明日才能卖出
- 检查每只股票的可交易状态
```

#### 3.3 止损检查（实时）
```
检查每只股票当前价 vs 买入价：
- 若跌幅 ≥ -12%：触发止损，生成卖出建议
- 注意T+1限制：今日买入的不能今日卖出

示例：
平安银行：买入价10.96，当前价9.50（-13.3%）
→ 触发止损，但需检查买入日期
→ 若今日买入：明日才能卖（02.24）
→ 若昨日买入：立即生成卖出建议
```

#### 3.4 调仓检查（月末）
```
触发条件：每月最后一个交易日14:30后

执行步骤：
1. 重新计算综合得分（PE+ROE）
2. 生成新的前10名股票列表
3. 对比当前持仓，确定调仓标的
4. 生成调仓方案（卖出+买入）
5. 注意T+1：先卖可卖的，再买新的
```

#### 3.5 交易日志记录（每次检查）
```
记录格式：
[时间] 股票代码 | 当前价 | 涨跌幅 | 操作建议 | 可交易状态

示例：
[2026-02-13 10:00] 000001 | 10.85 | -1.0% | 持有 | 可卖（昨日买入）
[2026-02-13 10:00] 000333 | 62.50 | -1.1% | 持有 | 不可卖（今日买入）
```

#### 3.6 净值跟踪（收盘后）
```
每日收盘后计算：
- 组合总市值
- 当日收益
- 累计收益
- 对比基准（沪深300）

记录到：trading_plan/vqm_portfolio_tracking.md
```

### 4. 学习策略检查与拓展（整点任务）
**触发条件：分钟数为 00-09（整点）**
**执行模式：与市场分析并行汇报（方案B）**

**执行步骤**：
1. 检查当前学习进度（已完成模块/待完成模块）
2. 评估学习效果（是否需要深化/横向拓展）
3. 生成学习拓展方案（量化/宏观/港股美股等）
4. 直接执行可立即开始的任务
5. **并行汇报**：与市场分析任务同时在整点汇报
6. **VQM策略优化**：根据实盘表现迭代策略参数

**当前学习阶段**：模块1-8已完成（财报/估值/行业/技术/实践/行业深度）
**量化投资阶段**：Day 3已完成（VQM策略启动），进入持续优化期

**拓展方向**：
- 🟢 量化投资策略（VQM策略实盘跟踪与优化）
- 🔲 宏观策略研究（利率/汇率/政策）
- 🔲 港美股行业研究（科技/医药/消费）
- 🔲 实盘策略优化（组合/风控/交易心理）

**产出文件**：`study/learning_roadmap.md`（学习路线图）

---

### 4. 学习任务执行（立即开始）

#### 当前学习阶段：模块9 - 量化投资（待开始）

**学习任务拆解（按小时规划）：**

| 时间 | 任务 | 产出物 | 状态 |
|------|------|--------|------|
| 第1小时 | 1.1 资产结构学习 | `01_balance_sheet_assets.md` | ✅ 完成 |
| 第2小时 | 1.2 负债分析学习 | `02_balance_sheet_liabilities.md` | ✅ 完成 |
| 第3小时 | 1.3 股东权益学习 | `03_balance_sheet_equity.md` | ✅ 完成 |
| 第3小时 | 1.3 股东权益学习 | `01_balance_sheet_equity.md` | 🔲 待开始 |
| 第4小时 | 1.4 关键比率学习 | `04_financial_ratios_solvency.md` | ✅ 完成 |
| 第5小时 | 2.1 收入分析学习 | `01_income_statement_revenue.md` | ✅ 完成 |
| 第6小时 | 2.2 成本分析学习 | `02_income_statement_cost.md` | ✅ 完成 |
| 第7小时 | 2.3 费用分析学习 | `03_income_statement_expenses.md` | ✅ 完成 |
| 第8小时 | 2.4 利润层级学习 | `04_income_statement_profit.md` | ✅ 完成 |
| 第9小时 | 3.1 经营现金流学习 | `01_cashflow_operations.md` | ✅ 完成 |
| 第10小时 | 3.2 投资筹资现金流学习 | `02_cashflow_investing_financing.md` | ✅ 完成 |
| 第11小时 | 3.3 现金流质量学习 | `03_cashflow_quality.md` | ✅ 完成 |
| 第12小时 | 4.1 杜邦分析法学习 | `01_dupont_analysis.md` | ✅ 完成 |
| 第13小时 | 4.2 估值模型学习 | `02_valuation_models.md` | ✅ 完成 |
| 第14小时 | 4.3 财务预警学习 | `03_financial_warning.md` | ✅ 完成 |
| 第15小时 | 5.1 行业生命周期学习 | `01_industry_lifecycle.md` | ✅ 完成 |
| 第16小时 | 5.2 产业链分析学习 | `02_industry_chain.md` | ✅ 完成 |
| 第17小时 | 5.3 行业比较学习 | `03_industry_comparison.md` | ✅ 完成 |
| 第18小时 | 6.1 K线技术学习 | `01_candlestick_patterns.md` | ✅ 完成 |
| 第19小时 | 6.2 量能分析学习 | `02_volume_analysis.md` | ✅ 完成 |
| 第20小时 | 6.3 技术指标学习 | `03_technical_indicators.md` | ✅ 完成 |
| 第21小时 | 6.4 量价关系学习 | `04_price_volume.md` | ✅ 完成 |

**学习执行规则：**
1. 每个心跳检查当前小时任务是否完成
2. 未完成则继续执行，完成后开始下一个任务
3. 每满1小时（整点）汇报上一个小时的工作结果

### 4. 每小时汇报机制

**触发条件：** 当前时间的分钟数为 00-09（即整点后10分钟内）

**汇报内容：**
```
[小时汇报] YYYY-MM-DD HH:00
- 上一个小时完成: [具体任务]
- 产出物: [文件路径]
- 学习要点: [3-5个核心要点]
- 累计进度: [X篇文档，约XXX字]
- 下一个小时: [计划任务]
```

---

### 5. 每日汇总汇报（23:00执行）

**触发时间**：每日 23:00-23:10

**汇报内容**：
```
[每日汇总] YYYY-MM-DD

一、今日完成
- 学习任务：XXX
- 研究产出：XXX
- 交易建议：XXX
- 其他任务：XXX

二、量化学习进度
- 当前阶段：XXX
- 已完成：XXX
- 进行中：XXX
- 待开始：XXX

三、明日计划
- 量化学习：XXX
- 市场监控：XXX
- 其他任务：XXX

四、关键指标
- 累计产出：X份文档，XX万字
- Git提交：X次
- 新增知识：XXX
```

**输出文件**：`memory/YYYY-MM-DD.md`（每日日志）
- 下一个小时计划: [下一个任务]
```

### 5. 当日任务检查
- 如果当前时间 **08:30-08:35**：【美股分析与复盘】结合隔夜美股收盘，分析对A股影响，生成开盘策略
- 如果当前时间 **09:00-09:20**：准备 A+H 分析
- 如果当前时间 **14:30-14:45**：【每日交易建议】结合当日盘中情况，给出尾盘调整策略
- 如果分析文件已生成：检查内容完整性

### 6. 美股分析与复盘任务（8:30执行）

**触发时间**：每日 08:30-08:35

**任务内容**：
1. **美股收盘复盘**
   - 道指/标普/纳指涨跌幅
   - 英伟达/科技龙头表现
   - 中概股表现（阿里/拼多多/京东）

2. **对A股影响分析**
   - AI算力板块（英伟达→中际旭创映射）
   - 新能源板块（特斯拉→宁德时代映射）
   - 中概互联（美股中概→港股科技→A股情绪）

3. **开盘策略建议**
   - 若美股大涨：A股高开概率，是否减仓
   - 若美股大跌：A股低开概率，是否加仓
   - 关键观察：北向资金流向/开盘板块强度

**输出文件**：`market_review/us_pre_market_YYYY-MM-DD.md`

**汇报格式**：
```
[美股复盘] YYYY-MM-DD 08:30

隔夜美股：
- 道指：XXX点（+/-X%）
- 标普：XXX点（+/-X%）
- 纳指：XXX点（+/-X%）
- 英伟达：$XX（+/-X%）
- 中概：KWEB +/−X%

对A股影响：
- AI算力：高开X%概率
- 新能源：高开X%概率
- 港股科技：高开X%概率

开盘策略：
- 若高开X%：建议减仓XX%
- 若低开X%：建议加仓XX%
- 关键观察：XXX
```

### 7. 每日交易建议任务（14:30执行）

**触发时间**：每日 14:30-14:45

**任务内容**：
1. **获取当日盘中数据**
   - 大盘指数（上证/深证/创业板）涨跌、成交量
   - 持仓标的实时价格、涨跌幅
   - 北向资金流向
   - 板块轮动情况

2. **分析当日盘面**
   - 大盘趋势判断（强势/弱势/震荡）
   - 持仓标的表现评估
   - 是否触发止损/止盈条件
   - 是否有加仓/减仓机会

3. **给出尾盘调整策略**
   - 是否需要在尾盘买入/卖出
   - 仓位调整建议
   - 次日操作预案

4. **更新交易计划**
   - 记录当日操作（如有）
   - 更新持仓成本/仓位
   - 生成次日交易计划

**输出文件**：`trading_plan/YYYY-MM-DD-trading-plan.md`

**汇报格式**：
```
[每日交易建议] YYYY-MM-DD 14:30

当日盘面：
- 上证指数：XXX点（+/-X%），成交量XXX亿
- 持仓表现：涨X%，跌X%，平X%
- 北向资金：流入/流出 XX亿

尾盘策略：
- 建议买入：XXX（价格区间XX-XX元，仓位X%）
- 建议卖出：XXX（触发止损/止盈）
- 建议持有：XXX（维持现状）

次日预案：
- 重点关注：XXX
- 买入计划：XXX
- 风险控制：XXX

当前持仓：
- 累计仓位：XX%
- 剩余现金：XX万
- 当日盈亏：+/-X%
```

### 7. 学习进度追踪

**模块1：财报分析基础 ✅ 完成（4/4）**
- [x] 1.1 资产负债表 - 资产结构
- [x] 1.2 资产负债表 - 负债分析
- [x] 1.3 资产负债表 - 股东权益
- [x] 1.4 关键比率 - 偿债能力

**模块2：利润表分析 ✅ 完成（4/4）**
- [x] 2.1 利润表 - 收入分析
- [x] 2.2 利润表 - 成本分析
- [x] 2.3 利润表 - 费用分析
- [x] 2.4 利润表 - 利润层级

**模块3：现金流量表 ✅ 完成（3/3）**
- [x] 3.1 现金流量表 - 经营活动现金流
- [x] 3.2 现金流量表 - 投资与筹资活动
- [x] 3.3 现金流量表 - 现金流质量分析

**模块4：财务分析进阶 ✅ 完成（3/3）**
- [x] 4.1 杜邦分析法 - ROE拆解与驱动因素
- [x] 4.2 估值模型 - PE/PB/PS/DCF方法
- [x] 4.3 财务预警 - 舞弊识别与风险信号

**模块5：行业分析框架 ✅ 完成（3/3）**
- [x] 5.1 行业生命周期与竞争格局
- [x] 5.2 产业链分析与护城河评估
- [x] 5.3 行业比较与轮动逻辑

**模块6：技术分析与实盘指标 ✅ 完成（4/4）**
- [x] 6.1 K线技术 - 形态识别与趋势判断
- [x] 6.2 量能分析 - 成交量与筹码分布
- [x] 6.3 技术指标 - MACD/KDJ/RSI/布林带
- [x] 6.4 量价关系 - 背离识别与买卖点

**模块8：行业深度研究 ✅ 完成（6/6）**

#### 学习目标：系统掌握各板块产业链、竞争格局、投资逻辑

| 板块 | 学习内容 | 产出物 | 状态 |
|:-----|:---------|:-------|:----:|
| 8.1 AI/半导体 | 算力产业链、芯片设计/制造/设备、竞争格局 | `industry_ai_semiconductor.md` | ✅ 完成 |
| 8.2 新能源 | 光伏/风电/储能/锂电产业链、技术路线、周期位置 | `industry_new_energy.md` | ✅ 完成 |
| 8.3 消费医药 | 白酒/食品饮料/医药CXO/创新药、品牌护城河 | `industry_consumer_healthcare.md` | ✅ 完成 |
| 8.4 高端制造 | 机械/军工/汽车零部件、国产替代、出海逻辑 | `industry_advanced_manufacturing.md` | ✅ 完成 |
| 8.5 高股息 | 煤炭/电力/银行/公用事业、股息率分析、防御价值 | `industry_high_dividend.md` | ✅ 完成 |
| 8.6 周期资源 | 有色/化工/钢铁、供需分析、价格周期 | `industry_cyclical_resources.md` | ✅ 完成 |

**学习规则**：
1. 每个板块学习覆盖：产业链图谱、龙头公司、竞争格局、周期位置、投资逻辑
2. 结合最新财报数据，分析当前景气度
3. 记录到行业研究笔记，便于后续快速查询

**核心发现汇总**：
| 板块 | 当前景气度 | 投资优先级 | 核心标的 |
|:-----|:----------:|:----------:|:---------|
| AI/半导体 | 🟢 高景气 | ⭐⭐⭐⭐⭐ | 中际旭创、北方华创、海光信息 |
| 新能源 | 🟡 分化 | ⭐⭐⭐⭐ | 储能（阳光电源）、海风（东方电缆） |
| 消费医药 | 🟡 弱复苏 | ⭐⭐⭐ | 茅台（左侧）、创新药出海（百济） |
| 高端制造 | 🟢 景气 | ⭐⭐⭐⭐ | 拓普集团、三花智控（汽车零部件出海） |
| 高股息 | 🟢 防御 | ⭐⭐⭐⭐ | 中国神华、长江电力、工商银行 |
| 周期资源 | 🟡 分化 | ⭐⭐⭐ | 铜（观望）、石油（高股息） |

**模块7：实践验证阶段 ✅ 完成（2/2）**
- [x] 7.1 历史案例回测验证
  - 案例1：中际旭创（300308）2023年初
    - 结果：✅ 分析框架验证成功
    - 目标价90-100元达成（实际最高170元）
    - 改进点：技术变革期需求弹性估计不足
  - 案例2：隆基绿能（601012）2023年
    - 结果：✅ 看空逻辑完全正确
    - 目标价20-22元达成（实际跌至22元）
    - 改进点：周期下行期业绩弹性估计需更悲观
  - 案例3：贵州茅台（600519）2023年10月
    - 结果：⚠️ 部分正确
    - 基本面判断正确，但忽略了宏观+风格因素
    - 改进点：加强宏观环境和催化剂分析
  - 产出：
    - `study/backtest/case_001_中际旭创_2023.md`
    - `study/backtest/case_002_隆基绿能_2023.md`
    - `study/backtest/case_003_贵州茅台_2023.md`
- [x] 7.2 数据接口优化
  - ✅ 检查AKShare/Tushare接口稳定性（AKShare不稳定30%，腾讯/新浪可用95%）
  - ✅ 开发备用数据源（新浪/腾讯API）
  - ✅ 优化代码性能和实时性
  - 产出：`tools/stock_data_provider.py`（多数据源自动切换）

**已完成：**
- [x] P0环境搭建：akshare/yfinance/pandas-ta安装
- [x] P0数据获取：fetch_data.py工具开发
- [x] 模块1：资产负债表完整分析（4篇文档，21439字）
- [x] 模块2：利润表完整分析（4篇文档，约22000字）
- [x] 模块3：现金流量表完整分析（3篇文档，约16658字）
- [x] 模块4：财务分析进阶（3篇文档，约11500字）
- [x] 模块5：行业分析框架（3篇文档，约7500字）
- [x] 模块6：技术分析与实盘指标（4篇文档，约8000字）
- [x] SOP文档：股票分析标准操作程序
- [ ] 模块7：实践验证（待开始）

---

## 汇报规则

### 心跳检查（每10分钟）
每次被heartbeat唤醒时，**必须执行以下判断**：

1. **检查当前时间分钟数**
   - 如果分钟数为 **00-09**：执行【小时汇报】（市场分析 + 学习进度并行）
   - 如果分钟数为 **10-59**：回复 `HEARTBEAT_OK`

2. **小时汇报内容（并行执行）**
   - **市场分析状态**：检查定时任务状态（8:30/9:15/14:30任务完成情况）
   - **学习进度汇报**：上一个小时学习任务完成情况
   - **格式**：分别列出市场和学习的要点

3. **汇报后记录**
   - 记录本次汇报的小时数，避免重复汇报同一小时

### 小时汇报格式（方案B：并行汇报）

```
[小时汇报] YYYY-MM-DD HH:00

【市场分析】
- 定时任务状态: [已完成/待触发]
- 上一个小时完成: [具体市场分析任务]
- 产出物: [报告文件路径]
- 行情要点: [3-5个核心市场要点]

【学习进度】
- 当前阶段: [量化投资Day X]
- 上一个小时完成: [具体学习任务]
- 产出物: [学习笔记/代码/报告]
- 学习要点: [3-5个核心知识点]

【累计进度】
- 市场报告: [X份]
- 学习文档: [X份，约XXX字]
- 代码产出: [X个文件]

【下一个小时】
- 市场任务: [待执行任务]
- 学习任务: [计划任务]
```

### 重复汇报防护
- 同一小时内只汇报一次
- 如果因网络延迟等原因错过00分，在01-09分内补报
- 超过10分钟未报，则视为该小时已跳过，不再补报

### 示例时间线
```
22:00 heartbeat唤醒 → 分钟=00 → 执行22点汇报
22:10 heartbeat唤醒 → 分钟=10 → 回复HEARTBEAT_OK
22:20 heartbeat唤醒 → 分钟=20 → 回复HEARTBEAT_OK
...
23:00 heartbeat唤醒 → 分钟=00 → 执行23点汇报
```
